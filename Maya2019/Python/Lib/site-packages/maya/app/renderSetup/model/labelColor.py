"""
    This module defines a base class to manage the label color which is a dynamic attribute for any DG Nodes.
"""
import maya.cmds as cmds
import maya.api.OpenMaya as OpenMaya
import maya.app.renderSetup.model.jsonTranslatorGlobals as jsonTranslatorGlobals
import maya.app.renderSetup.model.undo as undo


_LABEL_COLOR_ATTRIBUTE_SHORT_NAME = 'lc'

class LabelColor(object):
    """ 
        The class adds the support to the label color dynamic attribute.
    """

    def __init__(self):
        super(LabelColor, self).__init__()

    def _hasLabelColorPlug(self):
        return OpenMaya.MFnDependencyNode(self.thisMObject()).hasAttribute(jsonTranslatorGlobals.LABEL_COLOR_ATTRIBUTE_NAME)

    def _getLabelColorPlug(self):
        if not self._hasLabelColorPlug():
            # Use the command in order to allow undo/redo
            cmds.addAttr(self.name(), shortName=_LABEL_COLOR_ATTRIBUTE_SHORT_NAME, longName=jsonTranslatorGlobals.LABEL_COLOR_ATTRIBUTE_NAME, dataType='string')
        return OpenMaya.MFnDependencyNode(self.thisMObject()).findPlug(jsonTranslatorGlobals.LABEL_COLOR_ATTRIBUTE_NAME, True)

    def getLabelColor(self):
        # None means that no label color attribute is present on this specific node
        return self._getLabelColorPlug().asString() if self._hasLabelColorPlug() else None

    def setLabelColor(self, string):
        if string is None:
            cmds.deleteAttr(self.name(), at=LABEL_COLOR_ATTRIBUTE_NAME)
        else:
            with undo.NotifyCtxMgr( 'Set Label Color', self.itemChanged):
                self._getLabelColorPlug().setString(string)

    def _encodeProperties(self, dict):
        if self._hasLabelColorPlug() and self.getLabelColor()!='':
            dict[self._getLabelColorPlug().partialName(useLongNames=True)] = self.getLabelColor()

    def _decodeProperties(self, dict, mergeType, prependToName):
        if self._getLabelColorPlug().partialName(useLongNames=True) in dict:
            self.setLabelColor(dict[self._getLabelColorPlug().partialName(useLongNames=True)])
# ===========================================================================
# Copyright 2018 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
